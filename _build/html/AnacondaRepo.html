<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>1   Anaconda Repo Runbook &mdash; Continuum Runbooks 1.2.bkreider/versions documentation</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-3.3.6/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-3.3.6/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.2.bkreider/versions',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="Continuum Runbooks 1.2.bkreider/versions documentation" href="index.html" />
    <link rel="next" title="1   Anaconda Cluster Runbook" href="AnacondaCluster.html" />
    <link rel="prev" title="Continuum Analytics’ Implementation Runbooks" href="index.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body role="document">


<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="anaconda-repo-runbook">
<h1>1&nbsp;&nbsp;&nbsp;Anaconda Repo Runbook<a class="headerlink" href="#anaconda-repo-runbook" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li>Version: 1.2.bkreider/versions | Jun 16, 2016</li>
</ul>
<p>This following runbook walks through the steps needed to install
Anaconda Repo. The runbook is designed for two audiences: those who have
direct access to the internet for installation and those where such
access is not available or restricted for security reasons. For these
restricted a.k.a. &#8220;Air Gap&#8221; environments, Continuum ships the entire
Anaconda product suite on portable storage medium or as a downloadable
TAR archive. Where necessary, additional instructions for Air Gap
environments are noted. If you have any questions about the
instructions, please contact your sales representative or Priority
Support team, if applicable, for additional assistance.</p>
<img alt="_images/repo.png" src="_images/repo.png" />
<div class="section" id="requirements">
<h2>1.1&nbsp;&nbsp;&nbsp;Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h2>
<div class="section" id="hardware-requirements">
<h3>1.1.1&nbsp;&nbsp;&nbsp;Hardware Requirements<a class="headerlink" href="#hardware-requirements" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Physical server or VM</li>
<li>CPU: 2 x 64-bit 2 2.8GHz 8.00GT/s CPUs or better</li>
<li>Memory: 32GB RAM (per 50 users)</li>
<li>Storage: Recommended minimum of 300GB; Additional space is
recommended if the repository is will be used to store packages built
by the customer.</li>
</ul>
</div>
<div class="section" id="software-requirements">
<h3>1.1.2&nbsp;&nbsp;&nbsp;Software Requirements<a class="headerlink" href="#software-requirements" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>RHEL/CentOS 6.7 (Other operating systems are supported, however this
document assumes RHEL or CentOS 6.7)</li>
<li>MongoDB version 2.6</li>
<li>Anaconda Repo license file - given as part of the welcome packet -
contact your sales representative or support representative if you
cannot find your license.</li>
<li>cron: The anaconda-server user needs to add an entry to cron to start the server on reboot</li>
</ul>
</div>
<div class="section" id="linux-system-accounts-required">
<h3>1.1.3&nbsp;&nbsp;&nbsp;Linux System Accounts Required<a class="headerlink" href="#linux-system-accounts-required" title="Permalink to this headline">¶</a></h3>
<p>Some Linux system accounts (UIDs) are added to the system during installation.
If your organization requires special actions, here is the list of UIDs:</p>
<ul class="simple">
<li>mongod (RHEL) or mongodb (Ubuntu/Debian) - Created by the RPM or deb package</li>
<li>anaconda-server: Created manually during installation</li>
</ul>
</div>
<div class="section" id="security-requirements">
<h3>1.1.4&nbsp;&nbsp;&nbsp;Security Requirements<a class="headerlink" href="#security-requirements" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Privileged (root) access or sudo capabilities</li>
<li>Ability to make (optional) iptables modifications</li>
</ul>
<p><strong>NOTE</strong>: SELinux does not have to be disabled for Anaconda Repo
operation</p>
</div>
<div class="section" id="network-requirements">
<h3>1.1.5&nbsp;&nbsp;&nbsp;Network Requirements<a class="headerlink" href="#network-requirements" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>TCP Ports<ul>
<li>Inbound TCP 8080 (Anaconda Repo)</li>
<li>Inbound TCP 22 (SSH)</li>
<li>Outbound TCP 443 (to Anaconda Cloud or local Anaconda Repo)</li>
<li>Outbound TCP 25 (SMTP)</li>
<li>Outbound TCP 389/636 (LDAP(s))</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="other-requirements">
<h3>1.1.6&nbsp;&nbsp;&nbsp;Other Requirements<a class="headerlink" href="#other-requirements" title="Permalink to this headline">¶</a></h3>
<p>Assuming the above requirements are met, there are no additional
dependencies necessary for Anaconda Repo.</p>
</div>
<div class="section" id="air-gap-vs-regular-installation">
<h3>1.1.7&nbsp;&nbsp;&nbsp;Air Gap vs. Regular Installation<a class="headerlink" href="#air-gap-vs-regular-installation" title="Permalink to this headline">¶</a></h3>
<p>As stated previously, this document contains installation instructions
for two audiences: those with internet access on the destination
server(s) and those who have no access to internet resources. Many of
the steps below have two sections: <strong>Air Gap Installation</strong> and
<strong>Regular Installation</strong>. Those without internet access should follow
the <strong>Air Gap Installation</strong> instructions and those with internet access
should follow <strong>Regular Installation</strong> instructions.</p>
</div>
<div class="section" id="air-gap-media">
<h3>1.1.8&nbsp;&nbsp;&nbsp;Air Gap Media<a class="headerlink" href="#air-gap-media" title="Permalink to this headline">¶</a></h3>
<p>This document assumes that the Air Gap media is located at /installer on
the server where the software is being installed.</p>
</div>
<div class="section" id="air-gap-media-contents">
<h3>1.1.9&nbsp;&nbsp;&nbsp;Air Gap media contents<a class="headerlink" href="#air-gap-media-contents" title="Permalink to this headline">¶</a></h3>
<div class="highlight-bash"><div class="highlight"><pre><span></span>/installer
___ anaconda-suite
    ___ pkgs
mongodb-org-tools-2.6.8-1.x86_64.rpm
mongodb-org-shell-2.6.8-1.x86_64.rpm
mongodb-org-server-2.6.8-1.x86_64.rpm
mongodb-org-mongos-2.6.8-1.x86_64.rpm
mongodb-org-2.6.8-1.x86_64.rpm
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="installation-and-configuration">
<h1>2&nbsp;&nbsp;&nbsp;Installation and Configuration<a class="headerlink" href="#installation-and-configuration" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="auto-toc simple">
<li><a class="reference internal" href="#anaconda-repo-installation" id="id1">2.1&nbsp;&nbsp;&nbsp;Anaconda Repo Installation</a></li>
<li><a class="reference internal" href="#configure-anaconda-repo" id="id2">2.2&nbsp;&nbsp;&nbsp;Configure Anaconda Repo</a></li>
<li><a class="reference internal" href="#install-miniconda-bootstrap-version" id="id3">2.3&nbsp;&nbsp;&nbsp;Install Miniconda bootstrap version</a></li>
<li><a class="reference internal" href="#install-anaconda-repo-enterprise-packages" id="id4">2.4&nbsp;&nbsp;&nbsp;Install Anaconda Repo Enterprise Packages</a></li>
<li><a class="reference internal" href="#install-the-anaconda-repo-packages-via-conda" id="id5">2.5&nbsp;&nbsp;&nbsp;Install the Anaconda Repo packages via conda:</a></li>
<li><a class="reference internal" href="#configure-anaconda-repo-server" id="id6">2.6&nbsp;&nbsp;&nbsp;Configure Anaconda Repo Server</a></li>
<li><a class="reference internal" href="#set-up-automatic-restart-on-reboot-fail-or-error" id="id7">2.7&nbsp;&nbsp;&nbsp;Set up automatic restart on reboot, fail or error</a></li>
</ul>
</div>
<div class="section" id="anaconda-repo-installation">
<h2><a class="toc-backref" href="#id1">2.1&nbsp;&nbsp;&nbsp;Anaconda Repo Installation</a><a class="headerlink" href="#anaconda-repo-installation" title="Permalink to this headline">¶</a></h2>
<p>The following sections detail the steps required to install Anaconda
Repo.</p>
<div class="section" id="install-mongodb">
<h3>2.1.1&nbsp;&nbsp;&nbsp;Install MongoDB<a class="headerlink" href="#install-mongodb" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="download-mongodb-packages">
<h3>2.1.2&nbsp;&nbsp;&nbsp;Download MongoDB packages<a class="headerlink" href="#download-mongodb-packages" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><strong>Air Gap Installation:</strong> Skip this step.</li>
<li><strong>Regular Installation:</strong></li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span>RPM_CDN=&quot;https://820451f3d8380952ce65-4cc6343b423784e82fd202bb87cf87cf.ssl.cf1.rackcdn.com&quot;
curl -O $RPM_CDN/mongodb-org-tools-2.6.8-1.x86_64.rpm
curl -O $RPM_CDN/mongodb-org-shell-2.6.8-1.x86_64.rpm
curl -O $RPM_CDN/mongodb-org-server-2.6.8-1.x86_64.rpm
curl -O $RPM_CDN/mongodb-org-mongos-2.6.8-1.x86_64.rpm
curl -O $RPM_CDN/mongodb-org-2.6.8-1.x86_64.rpm
</pre></div>
</div>
</div>
<div class="section" id="install-mongodb-packages">
<h3>2.1.3&nbsp;&nbsp;&nbsp;Install MongoDB packages<a class="headerlink" href="#install-mongodb-packages" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><strong>Air Gap Installation:</strong></li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">yum</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="o">/</span><span class="n">installer</span><span class="o">/</span><span class="n">mongodb</span><span class="o">-</span><span class="n">org</span><span class="o">*</span>
</pre></div>
</div>
<ul class="simple">
<li><strong>Regular Installation:</strong></li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">yum</span> <span class="n">install</span> <span class="o">-</span><span class="n">y</span> <span class="n">mongodb</span><span class="o">-</span><span class="n">org</span><span class="o">*</span>
</pre></div>
</div>
</div>
<div class="section" id="start-mongodb">
<h3>2.1.4&nbsp;&nbsp;&nbsp;Start mongodb<a class="headerlink" href="#start-mongodb" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">service</span> <span class="n">mongod</span> <span class="n">start</span>
</pre></div>
</div>
</div>
<div class="section" id="verify-mongod-is-running">
<h3>2.1.5&nbsp;&nbsp;&nbsp;Verify mongod is running<a class="headerlink" href="#verify-mongod-is-running" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">service</span> <span class="n">mongod</span> <span class="n">status</span>
<span class="n">mongod</span> <span class="p">(</span><span class="n">pid</span> <span class="mi">1234</span><span class="p">)</span> <span class="ow">is</span> <span class="n">running</span><span class="o">...</span>
</pre></div>
</div>
<p><strong>NOTE:</strong> Additional mongodb installation information can be found
<a class="reference external" href="https://docs.mongodb.org/manual/tutorial/install-mongodb-on-red-hat/">here</a>.</p>
</div>
</div>
<div class="section" id="configure-anaconda-repo">
<h2><a class="toc-backref" href="#id2">2.2&nbsp;&nbsp;&nbsp;Configure Anaconda Repo</a><a class="headerlink" href="#configure-anaconda-repo" title="Permalink to this headline">¶</a></h2>
<div class="section" id="create-anaconda-repo-administrator-account">
<h3>2.2.1&nbsp;&nbsp;&nbsp;Create Anaconda Repo administrator account<a class="headerlink" href="#create-anaconda-repo-administrator-account" title="Permalink to this headline">¶</a></h3>
<p>In a terminal window, create a new user account for Anaconda Repo named
&#8220;anaconda-server&#8221;:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">useradd</span> <span class="o">-</span><span class="n">m</span> <span class="n">anaconda</span><span class="o">-</span><span class="n">server</span>
</pre></div>
</div>
<p><strong>NOTE:</strong> The anaconda-server user is the default for installing Anaconda Repo.
Any username can be used, however the use of the root user is
discouraged.</p>
</div>
<div class="section" id="create-anaconda-repo-directories">
<h3>2.2.2&nbsp;&nbsp;&nbsp;Create Anaconda Repo directories<a class="headerlink" href="#create-anaconda-repo-directories" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">mkdir</span> <span class="o">-</span><span class="n">m</span> <span class="mi">0770</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">anaconda</span><span class="o">-</span><span class="n">server</span>
<span class="n">sudo</span> <span class="n">mkdir</span> <span class="o">-</span><span class="n">m</span> <span class="mi">0770</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">anaconda</span><span class="o">-</span><span class="n">server</span>
<span class="n">sudo</span> <span class="n">mkdir</span> <span class="o">-</span><span class="n">m</span> <span class="mi">0770</span> <span class="o">-</span><span class="n">p</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">anaconda</span><span class="o">-</span><span class="n">server</span><span class="o">/</span><span class="n">package</span><span class="o">-</span><span class="n">storage</span>
<span class="n">sudo</span> <span class="n">mkdir</span> <span class="o">-</span><span class="n">m</span> <span class="mi">0770</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">anaconda</span><span class="o">-</span><span class="n">server</span><span class="o">/</span><span class="n">mirrors</span>
</pre></div>
</div>
</div>
<div class="section" id="give-the-anaconda-server-user-ownership-of-directories">
<h3>2.2.3&nbsp;&nbsp;&nbsp;Give the anaconda-server user ownership of directories<a class="headerlink" href="#give-the-anaconda-server-user-ownership-of-directories" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">chown</span> <span class="o">-</span><span class="n">R</span> <span class="n">anaconda</span><span class="o">-</span><span class="n">server</span><span class="o">.</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">anaconda</span><span class="o">-</span><span class="n">server</span>
<span class="n">sudo</span> <span class="n">chown</span> <span class="o">-</span><span class="n">R</span> <span class="n">anaconda</span><span class="o">-</span><span class="n">server</span><span class="o">.</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">anaconda</span><span class="o">-</span><span class="n">server</span>
<span class="n">sudo</span> <span class="n">chown</span> <span class="o">-</span><span class="n">R</span> <span class="n">anaconda</span><span class="o">-</span><span class="n">server</span><span class="o">.</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">anaconda</span><span class="o">-</span><span class="n">server</span><span class="o">/</span><span class="n">package</span><span class="o">-</span><span class="n">storage</span>
<span class="n">sudo</span> <span class="n">chown</span> <span class="o">-</span><span class="n">R</span> <span class="n">anaconda</span><span class="o">-</span><span class="n">server</span><span class="o">.</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">anaconda</span><span class="o">-</span><span class="n">server</span><span class="o">/</span><span class="n">mirrors</span>
</pre></div>
</div>
</div>
<div class="section" id="switch-to-the-anaconda-repo-administrator-account">
<h3>2.2.4&nbsp;&nbsp;&nbsp;Switch to the Anaconda Repo administrator account<a class="headerlink" href="#switch-to-the-anaconda-repo-administrator-account" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">su</span> <span class="o">-</span> <span class="n">anaconda</span><span class="o">-</span><span class="n">server</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="install-miniconda-bootstrap-version">
<h2><a class="toc-backref" href="#id3">2.3&nbsp;&nbsp;&nbsp;Install Miniconda bootstrap version</a><a class="headerlink" href="#install-miniconda-bootstrap-version" title="Permalink to this headline">¶</a></h2>
<div class="section" id="fetch-the-download-script-using-curl">
<h3>2.3.1&nbsp;&nbsp;&nbsp;Fetch the download script using curl<a class="headerlink" href="#fetch-the-download-script-using-curl" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><strong>Air Gap Installation:</strong> Skip this step.</li>
<li><strong>Regular Installation:</strong></li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="s1">&#39;http://repo.continuum.io/miniconda/Miniconda2-latest-Linux-x86_64.sh&#39;</span> <span class="o">&gt;</span> <span class="n">Miniconda</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
</div>
<div class="section" id="run-the-miniconda-sh-installer-script">
<h3>2.3.2&nbsp;&nbsp;&nbsp;Run the Miniconda.sh installer script<a class="headerlink" href="#run-the-miniconda-sh-installer-script" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><strong>Air Gap Installation:</strong></li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">bash</span> <span class="o">/</span><span class="n">installer</span><span class="o">/</span><span class="n">anaconda</span><span class="o">-</span><span class="n">suite</span><span class="o">/</span><span class="n">miniconda</span><span class="o">/</span><span class="n">Miniconda</span><span class="o">-</span><span class="n">latest</span><span class="o">-</span><span class="n">Linux</span><span class="o">-</span><span class="n">x86_64</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<ul class="simple">
<li><strong>Regular Installation:</strong></li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">bash</span> <span class="n">Miniconda</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
</div>
<div class="section" id="review-and-accept-the-license-terms">
<h3>2.3.3&nbsp;&nbsp;&nbsp;Review and accept the license terms<a class="headerlink" href="#review-and-accept-the-license-terms" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span>Welcome to Miniconda (by Continuum Analytics, Inc.)
In order to continue the installation process, please review the license agreement.
Please, press ENTER to continue. Do you approve the license terms? [yes|no] yes
</pre></div>
</div>
</div>
<div class="section" id="accept-the-default-location-or-specify-an-alternative">
<h3>2.3.4&nbsp;&nbsp;&nbsp;Accept the default location or specify an alternative:<a class="headerlink" href="#accept-the-default-location-or-specify-an-alternative" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Miniconda</span> <span class="n">will</span> <span class="n">now</span> <span class="n">be</span> <span class="n">installed</span> <span class="n">into</span> <span class="n">this</span> <span class="n">location</span><span class="p">:</span>
<span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">anaconda</span><span class="o">-</span><span class="n">server</span><span class="o">/</span><span class="n">miniconda2</span>
<span class="o">-</span><span class="n">Press</span> <span class="n">ENTER</span> <span class="n">to</span> <span class="n">confirm</span> <span class="n">the</span> <span class="n">location</span>
<span class="o">-</span><span class="n">Press</span> <span class="n">CTRL</span><span class="o">-</span><span class="n">C</span> <span class="n">to</span> <span class="n">abort</span> <span class="n">the</span> <span class="n">installation</span>
<span class="o">-</span><span class="n">Or</span> <span class="n">specify</span> <span class="n">a</span> <span class="n">different</span> <span class="n">location</span> <span class="n">below</span>
 <span class="p">[</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">anaconda</span><span class="o">-</span><span class="n">server</span><span class="o">/</span><span class="n">miniconda2</span><span class="p">]</span> <span class="o">&gt;&gt;&gt;</span><span class="s2">&quot; [Press ENTER]</span>
 <span class="n">PREFIX</span><span class="o">=/</span><span class="n">home</span><span class="o">/</span><span class="n">anaconda</span><span class="o">-</span><span class="n">server</span><span class="o">/</span><span class="n">miniconda2</span>
</pre></div>
</div>
</div>
<div class="section" id="update-the-anaconda-server-user-s-path">
<h3>2.3.5&nbsp;&nbsp;&nbsp;Update the anaconda-server user&#8217;s path<a class="headerlink" href="#update-the-anaconda-server-user-s-path" title="Permalink to this headline">¶</a></h3>
<p>Do you wish the installer to prepend the Miniconda install location to
PATH in your /home/anaconda-server/.bashrc ?</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">yes</span><span class="o">|</span><span class="n">no</span><span class="p">]</span> <span class="n">yes</span>
</pre></div>
</div>
</div>
<div class="section" id="for-the-new-path-changes-to-take-effect-source-your-bashrc">
<h3>2.3.6&nbsp;&nbsp;&nbsp;For the new path changes to take effect, “source” your .bashrc<a class="headerlink" href="#for-the-new-path-changes-to-take-effect-source-your-bashrc" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="o">~/.</span><span class="n">bashrc</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="install-anaconda-repo-enterprise-packages">
<h2><a class="toc-backref" href="#id4">2.4&nbsp;&nbsp;&nbsp;Install Anaconda Repo Enterprise Packages</a><a class="headerlink" href="#install-anaconda-repo-enterprise-packages" title="Permalink to this headline">¶</a></h2>
<div class="section" id="add-the-binstar-and-anaconda-server-repo-channels-to-conda">
<h3>2.4.1&nbsp;&nbsp;&nbsp;Add the Binstar and Anaconda-Server Repo channels to conda:<a class="headerlink" href="#add-the-binstar-and-anaconda-server-repo-channels-to-conda" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><strong>Air Gap Installation:</strong> Add the channels from local files.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">config</span> <span class="o">--</span><span class="n">add</span> <span class="n">channels</span>  <span class="n">file</span><span class="p">:</span><span class="o">///</span><span class="n">installer</span><span class="o">/</span><span class="n">anaconda</span><span class="o">-</span><span class="n">suite</span><span class="o">/</span><span class="n">pkgs</span><span class="o">/</span>
<span class="n">conda</span> <span class="n">config</span> <span class="o">--</span><span class="n">remove</span> <span class="n">channels</span> <span class="n">defaults</span> <span class="o">--</span><span class="n">force</span>
</pre></div>
</div>
<ul class="simple">
<li><strong>Regular Installation:</strong> Add the channels from Anaconda Cloud.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span>export BINSTAR_TOKEN=&lt;your binstar token&gt;
export ANACONDA_TOKEN=&lt;your anaconda-server token&gt;
conda config --add channels https://conda.anaconda.org/t/$BINSTAR_TOKEN/binstar/
conda config --add channels https://conda.anaconda.org/t/$ANACONDA_TOKEN/anaconda-server/
</pre></div>
</div>
<p><strong>Note:</strong> You should have received <strong>two</strong> tokens from Continuum
Support, one for each channel. If you haven&#8217;t, please contact
<a class="reference external" href="mailto:support&#37;&#52;&#48;continuum&#46;io">support<span>&#64;</span>continuum<span>&#46;</span>io</a>. Tokens are not required for Air Gap installs.</p>
</div>
</div>
<div class="section" id="install-the-anaconda-repo-packages-via-conda">
<h2><a class="toc-backref" href="#id5">2.5&nbsp;&nbsp;&nbsp;Install the Anaconda Repo packages via conda:</a><a class="headerlink" href="#install-the-anaconda-repo-packages-via-conda" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">install</span> <span class="n">anaconda</span><span class="o">-</span><span class="n">client</span> <span class="n">binstar</span><span class="o">-</span><span class="n">server</span> <span class="n">binstar</span><span class="o">-</span><span class="n">static</span> <span class="n">cas</span><span class="o">-</span><span class="n">mirror</span>
</pre></div>
</div>
</div>
<div class="section" id="configure-anaconda-repo-server">
<h2><a class="toc-backref" href="#id6">2.6&nbsp;&nbsp;&nbsp;Configure Anaconda Repo Server</a><a class="headerlink" href="#configure-anaconda-repo-server" title="Permalink to this headline">¶</a></h2>
<div class="section" id="initialize-the-web-server-for-anaconda-repo">
<h3>2.6.1&nbsp;&nbsp;&nbsp;Initialize the web server for Anaconda Repo:<a class="headerlink" href="#initialize-the-web-server-for-anaconda-repo" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">anaconda</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">config</span> <span class="o">--</span><span class="n">init</span> <span class="o">--</span><span class="n">config</span><span class="o">-</span><span class="n">file</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">anaconda</span><span class="o">-</span><span class="n">server</span><span class="o">/</span><span class="n">config</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
</div>
<div class="section" id="set-the-anaconda-repo-package-storage-location">
<h3>2.6.2&nbsp;&nbsp;&nbsp;Set the Anaconda Repo package storage location:<a class="headerlink" href="#set-the-anaconda-repo-package-storage-location" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">anaconda</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">config</span> <span class="o">--</span><span class="nb">set</span> <span class="n">fs_storage_root</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">anaconda</span><span class="o">-</span><span class="n">server</span><span class="o">/</span><span class="n">package</span><span class="o">-</span><span class="n">storage</span> <span class="o">--</span><span class="n">config</span><span class="o">-</span><span class="n">file</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">anaconda</span><span class="o">-</span><span class="n">server</span><span class="o">/</span><span class="n">config</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
</div>
<div class="section" id="create-an-initial-superuser-account-for-anaconda-repo">
<h3>2.6.3&nbsp;&nbsp;&nbsp;Create an initial “superuser” account for Anaconda Repo:<a class="headerlink" href="#create-an-initial-superuser-account-for-anaconda-repo" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">anaconda</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">create</span><span class="o">-</span><span class="n">user</span> <span class="o">--</span><span class="n">username</span> <span class="s2">&quot;superuser&quot;</span> <span class="o">--</span><span class="n">password</span> <span class="s2">&quot;yourpassword&quot;</span> <span class="o">--</span><span class="n">email</span> <span class="s2">&quot;your@email.com&quot;</span> <span class="o">--</span><span class="n">superuser</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Note:</th><td class="field-body">to ensure the bash shell does not process any of the
characters in this password, limit the password to lower case letters,
upper case letters and numbers, with no punctuation. After setup the
password can be changed with the web interface.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="initialize-the-anaconda-repo-database">
<h3>2.6.4&nbsp;&nbsp;&nbsp;Initialize the Anaconda Repo database:<a class="headerlink" href="#initialize-the-anaconda-repo-database" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">anaconda</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">db</span><span class="o">-</span><span class="n">setup</span> <span class="o">--</span><span class="n">execute</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="set-up-automatic-restart-on-reboot-fail-or-error">
<h2><a class="toc-backref" href="#id7">2.7&nbsp;&nbsp;&nbsp;Set up automatic restart on reboot, fail or error</a><a class="headerlink" href="#set-up-automatic-restart-on-reboot-fail-or-error" title="Permalink to this headline">¶</a></h2>
<div class="section" id="configure-supervisord">
<h3>2.7.1&nbsp;&nbsp;&nbsp;Configure Supervisord<a class="headerlink" href="#configure-supervisord" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">anaconda</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">install</span><span class="o">-</span><span class="n">supervisord</span><span class="o">-</span><span class="n">config</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>This step:</p>
<ul>
<li><p class="first">creates the following entry in the anaconda-server user’s crontab:</p>
<p><code class="docutils literal"><span class="pre">&#64;reboot</span> <span class="pre">/home/anaconda-server/miniconda/bin/supervisord</span></code></p>
</li>
<li><p class="first">generates the <code class="docutils literal"><span class="pre">/home/anaconda-server/miniconda/etc/supervisord.conf</span></code> file</p>
</li>
</ul>
</div>
<div class="section" id="verify-the-server-is-running">
<h3>2.7.2&nbsp;&nbsp;&nbsp;Verify the server is running:<a class="headerlink" href="#verify-the-server-is-running" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">supervisorctl</span> <span class="n">status</span>

<span class="n">binstar</span><span class="o">-</span><span class="n">server</span> <span class="n">RUNNING</span>   <span class="n">pid</span> <span class="mi">10831</span><span class="p">,</span> <span class="n">uptime</span> <span class="mi">0</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">05</span>
<span class="n">binstar</span><span class="o">-</span><span class="n">worker</span> <span class="n">RUNNING</span>   <span class="n">pid</span> <span class="mi">2784</span><span class="p">,</span> <span class="n">uptime</span> <span class="mi">0</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">04</span>
<span class="o">...</span>
<span class="o">...</span>
</pre></div>
</div>
</div>
<div class="section" id="install-anaconda-repo-license">
<h3>2.7.3&nbsp;&nbsp;&nbsp;Install Anaconda Repo License<a class="headerlink" href="#install-anaconda-repo-license" title="Permalink to this headline">¶</a></h3>
<p>Visit <strong>http://your.anaconda.server:8080</strong>. Follow the onscreen
instructions and upload your license file. Log in with the superuser
user and password configured above. After submitting, you should see the
login page.</p>
<p><strong>NOTE:</strong> Contact your sales representative or support representative if
you cannot find or have questions about your license.</p>
</div>
<div class="section" id="mirror-installers-for-miniconda">
<h3>2.7.4&nbsp;&nbsp;&nbsp;Mirror Installers for Miniconda<a class="headerlink" href="#mirror-installers-for-miniconda" title="Permalink to this headline">¶</a></h3>
<p>Miniconda installers can be served by Anaconda Repo via the <strong>static</strong>
directory located at
<strong>/home/anaconda-server/miniconda2/lib/python2.7/site-packages/binstar/static/extras</strong>.
This is <strong>required</strong> for Anaconda Cluster integration. To serve up the
latest Miniconda installers for each platform, download them and copy
them to the <strong>extras</strong> directory.</p>
<p>Users will then be able to download installers at a URL that looks like the
following: <a class="reference external" href="http:/">http:/</a>/&lt;your host&gt;:8080/static/Miniconda3-latest-Linux-x86_64.sh</p>
<ul>
<li><p class="first"><strong>Air Gap Installation:</strong></p>
<div class="highlight-default"><div class="highlight"><pre><span></span># miniconda installers
mkdir -p /tmp/extras
pushd /tmp/extras
URL=&quot;file:///installer/anaconda-suite/miniconda/&quot;
versions=&quot;Miniconda3-latest-Linux-x86_64.sh \
Miniconda3-latest-MacOSX-x86_64.sh \
Miniconda3-latest-Windows-x86.exe \
Miniconda3-latest-Windows-x86_64.exe \
Miniconda-latest-Linux-x86_64.sh \
Miniconda-latest-MacOSX-x86_64.sh \
Miniconda-latest-Windows-x86.exe \
Miniconda-latest-Windows-x86_64.exe&quot;

for installer in $versions
 do
  curl -O $URL$installer
done

# Move installers into static directory
popd
cp -a /tmp/extras \
  /home/anaconda-server/miniconda2/lib/python2.7/site-packages/binstar/static
</pre></div>
</div>
</li>
<li><p class="first"><strong>Regular Installation:</strong></p>
<div class="highlight-default"><div class="highlight"><pre><span></span># miniconda installers
mkdir -p /tmp/extras
pushd /tmp/extras
URL=&quot;https://repo.continuum.io/miniconda/&quot;
versions=&quot;Miniconda3-latest-Linux-x86_64.sh \
Miniconda3-latest-MacOSX-x86_64.sh \
Miniconda3-latest-Windows-x86.exe \
Miniconda3-latest-Windows-x86_64.exe \
Miniconda-latest-Linux-x86_64.sh \
Miniconda-latest-MacOSX-x86_64.sh \
Miniconda-latest-Windows-x86.exe \
Miniconda-latest-Windows-x86_64.exe&quot;

for installer in $versions
 do
  curl -O $URL$installer
done

# Move installers into static directory
popd
cp -a /tmp/extras /home/anaconda-server/miniconda2/lib/python2.7/site-packages/binstar/static
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="mirror-anaconda-repo">
<h3>2.7.5&nbsp;&nbsp;&nbsp;Mirror Anaconda Repo<a class="headerlink" href="#mirror-anaconda-repo" title="Permalink to this headline">¶</a></h3>
<p>Now that Anaconda Repo is installed, we want to mirror packages into our
local repository. If mirroring from Anaconda Cloud, the process will
take hours or longer, depending on the available internet bandwidth. Use
the <code class="docutils literal"><span class="pre">anaconda-server-sync-conda</span></code> command to mirror all Anaconda
packages locally under the &#8220;anaconda&#8221; user account.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Note:</th><td class="field-body">Ignore any license warnings. Additional mirror filtering/whitelisting/blacklisting options can be found <a class="reference external" href="https://docs.continuum.io/anaconda-repository/mirrors-sync-configuration">here</a>.</td>
</tr>
</tbody>
</table>
<ul>
<li><p class="first"><strong>Air Gap Installation:</strong> Since we&#8217;re mirroring from a local
filesystem, some additional configuration is necessary.</p>
<p><strong>1.</strong> Create a mirror config file:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">vi</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">anaconda</span><span class="o">-</span><span class="n">server</span><span class="o">/</span><span class="n">mirrors</span><span class="o">/</span><span class="n">conda</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
<p>Add the following:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">channels</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">file</span><span class="p">:</span><span class="o">///</span><span class="n">installer</span><span class="o">/</span><span class="n">anaconda</span><span class="o">-</span><span class="n">suite</span><span class="o">/</span><span class="n">pkgs</span>
</pre></div>
</div>
<p><strong>2.</strong> Mirror the Anaconda packages:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">anaconda</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">sync</span><span class="o">-</span><span class="n">conda</span> <span class="o">--</span><span class="n">mirror</span><span class="o">-</span><span class="n">config</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">anaconda</span><span class="o">-</span><span class="n">server</span><span class="o">/</span><span class="n">mirrors</span><span class="o">/</span><span class="n">conda</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
</li>
<li><p class="first"><strong>Regular Installation:</strong> Mirror from Anaconda Cloud.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">anaconda</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">sync</span><span class="o">-</span><span class="n">conda</span>
</pre></div>
</div>
</li>
</ul>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Note:</th><td class="field-body">Depending on the type of installation, this process may take hours.</td>
</tr>
</tbody>
</table>
<p>To verify the local Anaconda Repo repo has been populated, visit
<strong>http://your.anaconda.server:8080/anaconda</strong> in a browser.</p>
</div>
<div class="section" id="optional-mirror-the-r-channel">
<h3>2.7.6&nbsp;&nbsp;&nbsp;Optional: Mirror the R channel<a class="headerlink" href="#optional-mirror-the-r-channel" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first"><strong>Air Gap Installation:</strong></p>
<p><strong>1.</strong> Create a mirror config file:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">vi</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">anaconda</span><span class="o">-</span><span class="n">server</span><span class="o">/</span><span class="n">mirrors</span><span class="o">/</span><span class="n">r</span><span class="o">-</span><span class="n">chanel</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
<p><strong>2.</strong> Add the following:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">channels</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">file</span><span class="p">:</span><span class="o">///</span><span class="n">installer</span><span class="o">/</span><span class="n">r</span><span class="o">/</span><span class="n">pkgs</span>
</pre></div>
</div>
<p><strong>3.</strong> Mirror the Anaconda Cluster Management packages:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">anaconda</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">sync</span><span class="o">-</span><span class="n">conda</span> <span class="o">--</span><span class="n">mirror</span><span class="o">-</span><span class="n">config</span> \
    <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">anaconda</span><span class="o">-</span><span class="n">server</span><span class="o">/</span><span class="n">mirrors</span><span class="o">/</span><span class="n">r</span><span class="o">-</span><span class="n">channel</span><span class="o">.</span><span class="n">yaml</span> <span class="o">--</span><span class="n">account</span><span class="o">=</span><span class="n">r</span><span class="o">-</span><span class="n">channel</span>
</pre></div>
</div>
</li>
<li><p class="first"><strong>Regular Installation:</strong></p>
<p><strong>1.</strong> Create a mirror config file:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">vi</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">anaconda</span><span class="o">-</span><span class="n">server</span><span class="o">/</span><span class="n">mirrors</span><span class="o">/</span><span class="n">r</span><span class="o">-</span><span class="n">channel</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
<p><strong>2.</strong> Add the following:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">channels</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">conda</span><span class="o">.</span><span class="n">anaconda</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">r</span>
</pre></div>
</div>
<p><strong>3.</strong> Mirror the R packages:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">anaconda</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">sync</span><span class="o">-</span><span class="n">conda</span> <span class="o">--</span><span class="n">mirror</span><span class="o">-</span><span class="n">config</span> \
    <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">anaconda</span><span class="o">-</span><span class="n">server</span><span class="o">/</span><span class="n">mirrors</span><span class="o">/</span><span class="n">r</span><span class="o">-</span><span class="n">channel</span><span class="o">.</span><span class="n">yaml</span> <span class="o">--</span><span class="n">account</span><span class="o">=</span><span class="n">r</span><span class="o">-</span><span class="n">channel</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="optional-mirror-the-anaconda-enterprise-notebooks-channel">
<h3>2.7.7&nbsp;&nbsp;&nbsp;Optional: Mirror the Anaconda Enterprise Notebooks Channel<a class="headerlink" href="#optional-mirror-the-anaconda-enterprise-notebooks-channel" title="Permalink to this headline">¶</a></h3>
<p>If the local Anaconda Repo will be used by Anaconda Enterprise Notebooks
the recommended method is to mirror using the “wakari” user.
To mirror the Anaconda Enterprise Notebooks repo, create the mirror config
YAML file below:</p>
<ul>
<li><p class="first"><strong>Air Gap Installation:</strong></p>
<p><strong>1.</strong> Create a mirror config file:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">vi</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">anaconda</span><span class="o">-</span><span class="n">server</span><span class="o">/</span><span class="n">mirrors</span><span class="o">/</span><span class="n">wakari</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
<p><strong>2.</strong> Add the following:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">channels</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">file</span><span class="p">:</span><span class="o">///</span><span class="n">installer</span><span class="o">/</span><span class="n">wakari</span><span class="o">/</span><span class="n">pkgs</span>
  <span class="o">-</span> <span class="n">file</span><span class="p">:</span><span class="o">///</span><span class="n">installer</span><span class="o">/</span><span class="n">anaconda</span><span class="o">-</span><span class="n">nb</span><span class="o">-</span><span class="n">extensions</span><span class="o">/</span><span class="n">pkgs</span>
</pre></div>
</div>
<p><strong>3.</strong> Mirror the Anaconda Enteprise Notebooks packages:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">anaconda</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">sync</span><span class="o">-</span><span class="n">conda</span> <span class="o">--</span><span class="n">mirror</span><span class="o">-</span><span class="n">config</span> \
    <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">anaconda</span><span class="o">-</span><span class="n">server</span><span class="o">/</span><span class="n">mirrors</span><span class="o">/</span><span class="n">wakari</span><span class="o">.</span><span class="n">yaml</span> <span class="o">--</span><span class="n">account</span><span class="o">=</span><span class="n">wakari</span>
</pre></div>
</div>
</li>
<li><p class="first"><strong>Regular Installation:</strong></p>
<p><strong>1.</strong> Create a mirror config file:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">vi</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">anaconda</span><span class="o">-</span><span class="n">server</span><span class="o">/</span><span class="n">mirrors</span><span class="o">/</span><span class="n">wakari</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
<p><strong>2.</strong> Add the following:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">channels</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">conda</span><span class="o">.</span><span class="n">anaconda</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">t</span><span class="o">/&lt;</span><span class="n">TOKEN</span><span class="o">&gt;/</span><span class="n">anaconda</span><span class="o">-</span><span class="n">nb</span><span class="o">-</span><span class="n">extensions</span>
  <span class="o">-</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">conda</span><span class="o">.</span><span class="n">anaconda</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">wakari</span>
</pre></div>
</div>
<p><strong>3.</strong> Mirror the Anaconda Enterprise Notebooks packages:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">anaconda</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">sync</span><span class="o">-</span><span class="n">conda</span> <span class="o">--</span><span class="n">mirror</span><span class="o">-</span><span class="n">config</span> \
  <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">anaconda</span><span class="o">-</span><span class="n">server</span><span class="o">/</span><span class="n">mirrors</span><span class="o">/</span><span class="n">wakari</span><span class="o">.</span><span class="n">yaml</span> <span class="o">--</span><span class="n">account</span><span class="o">=</span><span class="n">wakari</span>
</pre></div>
</div>
</li>
</ul>
<p>Where <strong>“TOKEN”</strong> is the Anaconda NB Extensions token you should
have received from Continuum Support.</p>
</div>
<div class="section" id="optional-mirror-the-anaconda-cluster-management-channel">
<h3>2.7.8&nbsp;&nbsp;&nbsp;Optional: Mirror the Anaconda Cluster Management channel<a class="headerlink" href="#optional-mirror-the-anaconda-cluster-management-channel" title="Permalink to this headline">¶</a></h3>
<p>If the local Anaconda Repo will be used by Anaconda Cluster nodes (head
or compute), the recommended method is to mirror using an
“anaconda-cluster” user. To mirror the Anaconda Cluster Management repo,
create the mirror config YAML file below:</p>
<ul>
<li><p class="first"><strong>Air Gap Installation:</strong></p>
<p><strong>1.</strong> Create a mirror config file:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">vi</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">anaconda</span><span class="o">-</span><span class="n">server</span><span class="o">/</span><span class="n">mirrors</span><span class="o">/</span><span class="n">anaconda</span><span class="o">-</span><span class="n">cluster</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
<p><strong>2.</strong> Add the following:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">channels</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">file</span><span class="p">:</span><span class="o">///</span><span class="n">installer</span><span class="o">/</span><span class="n">anaconda</span><span class="o">-</span><span class="n">cluster</span><span class="o">/</span><span class="n">pkgs</span>
</pre></div>
</div>
<p><strong>3.</strong> Mirror the Anaconda Cluster Management packages:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">anaconda</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">sync</span><span class="o">-</span><span class="n">conda</span> <span class="o">--</span><span class="n">mirror</span><span class="o">-</span><span class="n">config</span> \
   <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">anaconda</span><span class="o">-</span><span class="n">server</span><span class="o">/</span><span class="n">mirrors</span><span class="o">/</span><span class="n">anaconda</span><span class="o">-</span><span class="n">cluster</span><span class="o">.</span><span class="n">yaml</span> \
   <span class="o">--</span><span class="n">account</span><span class="o">=</span><span class="n">anaconda</span><span class="o">-</span><span class="n">cluster</span>
</pre></div>
</div>
</li>
<li><p class="first"><strong>Regular Installation:</strong></p>
<p><strong>1.</strong> Create a mirror config file:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">vi</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">anaconda</span><span class="o">-</span><span class="n">server</span><span class="o">/</span><span class="n">mirrors</span><span class="o">/</span><span class="n">anaconda</span><span class="o">-</span><span class="n">cluster</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
<p><strong>2.</strong> Add the following:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">channels</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">conda</span><span class="o">.</span><span class="n">anaconda</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">t</span><span class="o">/</span><span class="n">L8pxtQupjz01</span><span class="o">/</span><span class="n">anaconda</span><span class="o">-</span><span class="n">cluster</span>
</pre></div>
</div>
<p><strong>3.</strong> Mirror the Anaconda Cluster Management packages:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">anaconda</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">sync</span><span class="o">-</span><span class="n">conda</span> <span class="o">--</span><span class="n">mirror</span><span class="o">-</span><span class="n">config</span> \
   <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">anaconda</span><span class="o">-</span><span class="n">server</span><span class="o">/</span><span class="n">mirrors</span><span class="o">/</span><span class="n">anaconda</span><span class="o">-</span><span class="n">cluster</span><span class="o">.</span><span class="n">yaml</span> \
   <span class="o">--</span><span class="n">account</span><span class="o">=</span><span class="n">anaconda</span><span class="o">-</span><span class="n">cluster</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="optional-adjust-iptables-to-accept-requests-on-port-80">
<h3>2.7.9&nbsp;&nbsp;&nbsp;Optional: Adjust iptables to accept requests on port 80<a class="headerlink" href="#optional-adjust-iptables-to-accept-requests-on-port-80" title="Permalink to this headline">¶</a></h3>
<p>The easiest way to enable clients to access an Anaconda Repo on standard
ports is to configure the server to redirect traffic received on
standard HTTP port 80 to the standard Anaconda Repo HTTP port 8080.</p>
<p><strong>NOTE:</strong> These commands assume the default state of iptables on CentOS
6.7 which is “on” and allowing inbound SSH access on port 22. Take
caution; mistakes with iptables rules can render a remote machine
inaccessible.</p>
<p><strong>Allow inbound access to tcp port 80:</strong></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">iptables</span> <span class="o">-</span><span class="n">I</span> <span class="n">INPUT</span> <span class="o">-</span><span class="n">i</span> <span class="n">eth0</span> <span class="o">-</span><span class="n">p</span> <span class="n">tcp</span> <span class="o">--</span><span class="n">dport</span> <span class="mi">80</span> <span class="o">-</span><span class="n">m</span> <span class="n">comment</span> <span class="o">--</span><span class="n">comment</span> <span class="s2">&quot;# Anaconda Repo #&quot;</span> <span class="o">-</span><span class="n">j</span> <span class="n">ACCEPT</span>
</pre></div>
</div>
<p><strong>Allow inbound access to tcp port 8080:</strong></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">iptables</span> <span class="o">-</span><span class="n">I</span> <span class="n">INPUT</span> <span class="o">-</span><span class="n">i</span> <span class="n">eth0</span> <span class="o">-</span><span class="n">p</span> <span class="n">tcp</span> <span class="o">--</span><span class="n">dport</span> <span class="mi">8080</span> <span class="o">-</span><span class="n">m</span> <span class="n">comment</span> <span class="o">--</span><span class="n">comment</span> <span class="s2">&quot;# Anaconda Repo #&quot;</span> <span class="o">-</span><span class="n">j</span> <span class="n">ACCEPT</span>
</pre></div>
</div>
<p><strong>Redirect inbound requests to port 80 to port 8080:</strong></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">iptables</span> <span class="o">-</span><span class="n">A</span> <span class="n">PREROUTING</span> <span class="o">-</span><span class="n">t</span> <span class="n">nat</span> <span class="o">-</span><span class="n">i</span> <span class="n">eth0</span> <span class="o">-</span><span class="n">p</span> <span class="n">tcp</span> <span class="o">--</span><span class="n">dport</span> <span class="mi">80</span> <span class="o">-</span><span class="n">m</span> <span class="n">comment</span> <span class="o">--</span><span class="n">comment</span> <span class="s2">&quot;# Anaconda Repo #&quot;</span> <span class="o">-</span><span class="n">j</span> <span class="n">REDIRECT</span> <span class="o">--</span><span class="n">to</span><span class="o">-</span><span class="n">port</span> <span class="mi">8080</span>
</pre></div>
</div>
<p><strong>Display the current iptables rules:</strong></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">iptables</span> <span class="o">-</span><span class="n">L</span> <span class="o">-</span><span class="n">n</span>
<span class="n">Chain</span> <span class="n">INPUT</span> <span class="p">(</span><span class="n">policy</span> <span class="n">ACCEPT</span><span class="p">)</span>
<span class="n">target</span>     <span class="n">prot</span> <span class="n">opt</span> <span class="n">source</span>               <span class="n">destination</span>
<span class="n">ACCEPT</span>     <span class="n">tcp</span>  <span class="o">--</span>  <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span><span class="o">/</span><span class="mi">0</span>            <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span><span class="o">/</span><span class="mi">0</span>           <span class="n">tcp</span> <span class="n">dpt</span><span class="p">:</span><span class="mi">8080</span> <span class="c1"># Anaconda Repo #</span>
<span class="n">ACCEPT</span>     <span class="n">tcp</span>  <span class="o">--</span>  <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span><span class="o">/</span><span class="mi">0</span>            <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span><span class="o">/</span><span class="mi">0</span>           <span class="n">tcp</span> <span class="n">dpt</span><span class="p">:</span><span class="mi">80</span> <span class="c1"># Anaconda Repo #</span>
<span class="n">ACCEPT</span>     <span class="nb">all</span>  <span class="o">--</span>  <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span><span class="o">/</span><span class="mi">0</span>            <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span><span class="o">/</span><span class="mi">0</span>           <span class="n">state</span> <span class="n">RELATED</span><span class="p">,</span><span class="n">ESTABLISHED</span>
<span class="n">ACCEPT</span>     <span class="n">icmp</span> <span class="o">--</span>  <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span><span class="o">/</span><span class="mi">0</span>            <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span><span class="o">/</span><span class="mi">0</span>
<span class="n">ACCEPT</span>     <span class="nb">all</span>  <span class="o">--</span>  <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span><span class="o">/</span><span class="mi">0</span>            <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span><span class="o">/</span><span class="mi">0</span>
<span class="n">ACCEPT</span>     <span class="n">tcp</span>  <span class="o">--</span>  <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span><span class="o">/</span><span class="mi">0</span>            <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span><span class="o">/</span><span class="mi">0</span>           <span class="n">state</span> <span class="n">NEW</span> <span class="n">tcp</span> <span class="n">dpt</span><span class="p">:</span><span class="mi">22</span>
<span class="n">REJECT</span>     <span class="nb">all</span>  <span class="o">--</span>  <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span><span class="o">/</span><span class="mi">0</span>            <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span><span class="o">/</span><span class="mi">0</span>           <span class="n">reject</span><span class="o">-</span><span class="k">with</span> <span class="n">icmp</span><span class="o">-</span><span class="n">host</span><span class="o">-</span><span class="n">prohibited</span>

<span class="n">Chain</span> <span class="n">FORWARD</span> <span class="p">(</span><span class="n">policy</span> <span class="n">ACCEPT</span><span class="p">)</span>
<span class="n">target</span>     <span class="n">prot</span> <span class="n">opt</span> <span class="n">source</span>               <span class="n">destination</span>
<span class="n">REJECT</span>     <span class="nb">all</span>  <span class="o">--</span>  <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span><span class="o">/</span><span class="mi">0</span>            <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span><span class="o">/</span><span class="mi">0</span>           <span class="n">reject</span><span class="o">-</span><span class="k">with</span> <span class="n">icmp</span><span class="o">-</span><span class="n">host</span><span class="o">-</span><span class="n">prohibited</span>

<span class="n">Chain</span> <span class="n">OUTPUT</span> <span class="p">(</span><span class="n">policy</span> <span class="n">ACCEPT</span><span class="p">)</span>
<span class="n">target</span>     <span class="n">prot</span> <span class="n">opt</span> <span class="n">source</span>               <span class="n">destination</span>
</pre></div>
</div>
<p><strong>NOTE:</strong> the PREROUTING (nat) iptables chain is not displayed by
default; to show it, use:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">iptables</span> <span class="o">-</span><span class="n">L</span> <span class="o">-</span><span class="n">n</span> <span class="o">-</span><span class="n">t</span> <span class="n">nat</span>
<span class="n">Chain</span> <span class="n">PREROUTING</span> <span class="p">(</span><span class="n">policy</span> <span class="n">ACCEPT</span><span class="p">)</span>
<span class="n">target</span>     <span class="n">prot</span> <span class="n">opt</span> <span class="n">source</span>               <span class="n">destination</span>
<span class="n">REDIRECT</span>   <span class="n">tcp</span>  <span class="o">--</span>  <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span><span class="o">/</span><span class="mi">0</span>            <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span><span class="o">/</span><span class="mi">0</span>           <span class="n">tcp</span> <span class="n">dpt</span><span class="p">:</span><span class="mi">80</span> <span class="c1"># Anaconda Repo # redir ports 8080</span>

<span class="n">Chain</span> <span class="n">POSTROUTING</span> <span class="p">(</span><span class="n">policy</span> <span class="n">ACCEPT</span><span class="p">)</span>
<span class="n">target</span>     <span class="n">prot</span> <span class="n">opt</span> <span class="n">source</span>               <span class="n">destination</span>

<span class="n">Chain</span> <span class="n">OUTPUT</span> <span class="p">(</span><span class="n">policy</span> <span class="n">ACCEPT</span><span class="p">)</span>
<span class="n">target</span>     <span class="n">prot</span> <span class="n">opt</span> <span class="n">source</span>               <span class="n">destination</span>
</pre></div>
</div>
<p>Write the running iptables configuration to <strong>/etc/sysconfig/iptables:</strong></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">service</span> <span class="n">iptables</span> <span class="n">save</span>
</pre></div>
</div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>